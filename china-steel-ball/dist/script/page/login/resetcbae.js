var resetPageInstance=new WJF.component.view({data:{},events:{"click .J-op":function(a,b){var c=WJF.util.callBindFn(b,this,a.target);return void 0!==c&&c}},popEvents:{},customEvents:{},onBeforeDestroy:function(){this.unBindEvent()},regEvent:function(){this.bindEvent()},reset_one:function(a){function b(){return c.pageWrapper.find(".validate-code-img").attr("src","/login/verify-reset?codename=captcha1&amp;t="+(new Date).getTime()),!1}var c=this,d=c.pageWrapper.find('input[name="reset_email"]').val();d=d.replace(/\s+/g,"");var e=new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");if(""==d)return WJF.ui.alert.warn("请输入email"),!1;if(!e.test(d))return WJF.ui.alert.warn("请输入正确的email"),!1;var f=c.pageWrapper.find('input[name="reset_code"]').val();if(""==f)return WJF.ui.alert.warn(I18NMessage.common.WRITE_CODE_REQUIRED),!1;for(var g=d.split("@"),h=0;h<g.length;h++)g[h]=g[h].replace(/\s+/g,"");var i=g[0],j=g[1];return this.get("/login/checkverify-reset",{code:f},function(a){c.post("/login/resetway",{username:i,domain:j,code:f},function(a){c.data.finddata=a.data,c.pageWrapper.find("#J_reset_dc_2").html(template("tpl_J_reset_dc_2",a)),c.reset_two_int(),c.switchScene("J_reset_dc_2",{}),c.showsetp(1),c.pageWrapper.find("input[name='reset_type']").on("click",function(){c.reset_show_box()}),c.reset_show_box()},{failure:b,error:b})},{failure:b,error:b}),!1},reset_show_box:function(){var a=this;$("div[id^='reset_type_']").hide(),$("input[name='reset_type_1_val']").attr("data-validate","no"),$("input[name='reset_type_2_val']").attr("data-validate","no"),$(".resetway-form-btn").hide();var b=a.pageWrapper.find("input[name='reset_type']:checked").val();"2"==b?($("input[name='reset_type_2_val']").removeAttr("data-validate"),a.pageWrapper.find("#reset_type_2").show(),$(".resetway-form-btn").show()):"1"==b&&($("input[name='reset_type_1_val']").removeAttr("data-validate"),a.pageWrapper.find("#reset_type_1").show(),$(".resetway-form-btn").show())},reset_sent_wx:function(){var a=this,b=a.data.finddata;return 1!=b.wx?(WJF.ui.alert.warnTip(I18NMessage.page.login.NOT_BIND_WX),!1):void a.post("/login/wxcode",{domain:b.domain,username:b.username},function(a){WJF.ui.alert.successTip(I18NMessage.page.login.SEND_SUCCESS_WRITE_CODE)})},reset_two_go:function(){var a=this;a.switchScene("J_reset_dc_2",{}),a.showsetp(1)},reset_two:function(){function a(){b.post("/login/resetcheck/",d,function(a){"200"==a.code&&(b.switchScene("J_reset_dc_3",{}),b.reset_three_int(a.data),b.showsetp(2))},{showLoading:!0})}var b=this;b.data.resetdb={};var c=b.data.finddata,d={domain:c.domain,username:c.username},e=b.pageWrapper.find("input[name='reset_type']:checked").val(),f="postmaster";({domain:c.domain,username:c.username});if("0"==e)return WJF.ui.alert.successTip(I18NMessage.page.login.CONTACT_POSTMASTER_RESET_PWD),location.href=WJF.util.redirect("/login"),!1;if("1"==e){var g=b.pageWrapper.find("input[name='reset_type_1_val']").val();if(f="mibao",""==g)return WJF.ui.alert.warnTip(I18NMessage.page.login.ENCRYPTED_ANSWER_EMPTY),!1}else if("2"==e){f="wx";var h=b.pageWrapper.find("input[name='reset_type_2_val']").val();if(""==h)return WJF.ui.alert.warnTip(I18NMessage.page.login.WX_CODE_EMPTY_WARN),!1}d.type=f,d.answer=g||"",d.code=h||"",b.data.resetdb=d,"mibao"==d.type?require(["Encrypter"],function(b){d.answer=b.encrypt(d.answer),a()}):a()},reset_three:function(a){function b(){c.post(2==a.v?"/v2/login/resetpwd":"/login/resetpwd",d,function(a){"200"==a.code&&(c.switchScene("J_reset_dc_4",{}),c.showsetp(3))})}a=a||{};var c=this,d=c.data.resetdb,e=c.pageWrapper.find("input[name='reset_password']").val(),f=c.pageWrapper.find("input[name='reset_renpassword']").val();return""==e||e!=f?(WJF.ui.alert.warnTip(I18NMessage.page.login.PWD_ERROR_EMPTY),!1):void require(["Encrypter"],function(a){d.password=a.encrypt(e),d.confirm_password=a.encrypt(f),b()})},confirmResetThree:function(){this.reset_ThreeFormValidator.validateArea()},confirmResetTwo:function(){this.reset_TwoFormValidator.validateArea()},confirmResetOne:function(){this.reset_OneFormValidator.validateArea()},backResetOne:function(){this.switchScene("J_reset_dc_1",{}),this.showsetp(0)},reset_three_int:function(a){a=a||{},a.policy?a.policy=WJF.util.str2json(a.policy):a.policy=null;var b=this;this.reset_ThreeFormValidator=new CommonValidator("#J_reset_dc_3",{validateMsgParentSelector:"dd",pwdCompare:function(a){var b=$.trim($('input[name="reset_password"]').val());return!b||a===b},checkpwdlen:function(b){if(a.policy&&a.policy.length){var c=(a.policy.length+"").split("-");if(b.length<+c[0]||b.length>+c[1])return WJF.util.i18n(I18NMessage.common.PWD_LENGTH_RANGE,c[0],c[1])}return!(b.length<6)},itemTitleSelector:".resetway-form-title",afterAllValidated:function(c){c?b.reset_three(a):WJF.ui.alert.warn(I18NMessage.common.REVISE_PROMPT_ERROR)}}),this.pageWrapper.find("#J_pwdRulesDetail").html(template("J_pwdRulesDetailTpl",{rules:a.policy,I18NMessage:I18NMessage}))},reset_two_int:function(){var a=this;this.reset_TwoFormValidator=new CommonValidator("#J_reset_dc_2",{validateMsgParentSelector:"dd",itemTitleSelector:".resetway-form-title",afterAllValidated:function(b){b?a.reset_two():WJF.ui.alert.warn(I18NMessage.common.REVISE_PROMPT_ERROR)}})},reset_init:function(){var a=this;this.reset_OneFormValidator=new CommonValidator("#J_reset_dc_1",{validateMsgParentSelector:"dd",itemTitleSelector:".resetway-form-title",afterAllValidated:function(b){b?a.reset_one():WJF.ui.alert.warn(I18NMessage.common.REVISE_PROMPT_ERROR)}})},showsetp:function(a){var b=this,c=b.pageWrapper.find(".resetway-flow").find("li");c.removeClass("success"),c.removeClass("active");var d=0;$.each(c,function(b,c){d<a?$(this).addClass("success"):d==a&&$(this).addClass("active"),d++})},init:function(a,b){var c=this;this.regEvent(),this.data.domain=location.host.substr(location.host.indexOf(".")+1),require(["CommonTool","commonValidator","validateRules"],function(a){c.pageWrapper.find('input[name="reset_domain"]').val(c.data.domain),c.reset_init(),c.showsetp(0)})}});$(function(){resetPageInstance.init()});